<section class="lesson-material__content"><article class="material"><h1>Файлы в Python. Типы файлов и работа с ними. Внутреннее устройство файлов</h1>
<section class="material__plan"><nav>
<ol>
<li><a class="material__link" href="#1">Общие сведения о файлах</a></li>
<li><a class="material__link" href="#2">Перевод строки</a></li>
<li><a class="material__link" href="#3">Файловый путь. Относительные и абсолютные пути</a></li>
<li><a class="material__link" href="#4">Кодировки файлов</a></li>
<li><a class="material__link" href="#5">Типичные операции с файлами</a></li>
<li><a class="material__link" href="#6">Чтение файла</a></li>
<li><a class="material__link" href="#7">Запись в файл</a></li>
<li><a class="material__link" href="#8">Закрытие файлов</a></li>
<li><a class="material__link" href="#9">PyQT</a></li>
</ol>
</nav></section>
<section class="material__annotation">
<h2>Аннотация</h2>
<p>В уроке даются общие сведения о файлах и их хранении в современных ОС. Затрагиваются наиболее общие аспекты работы с файлами в Python: открытие, чтение/запись, закрытие текстовых и бинарных файлов. Обзорно рассмотрены вспомогательные функции («перемотка», работа с кодировками, построчное чтение).</p>
</section>
<section class="material__chapter">
<h2 id="1">Общие сведения о файлах</h2>
<p>Для работы с блоками логически объединенной информации, их хранения, обработки и передачи широко используются файлы.</p>
<section class="material__note">
<p class="material__note-heading"><strong>Файл</strong></p>
<p>Файл (англ. <em>file</em>) — именованная область данных на носителе информации.</p>
</section>
<p>Конкретная физическая организация файлов, их группировка по каталогам (папкам), устройство процедур доступа к информации, механизмы кеширования очень сильно зависят от операционной системы и применяемой в ней файловой системы. Как правило, при работе с файлами прикладные программисты работают на верхнем уровне <strong>абстракции</strong>.</p>
<p>Это означает, что файл представляет просто собой поток байт или текста заданного размера, а его реальное физическое устройство программиста абсолютно не интересует. Но грамотный программист должен хорошо представлять себе некоторые особенности работы с файлами, чтобы не совершать ошибки, связанные с оптимизацией и ускорением работы программы.</p>
<p>О чем надо всегда помнить:</p>
<ol>
<li>Файлы обычно располагаются на носителях, которые работают медленнее, чем оперативная память. Поэтому работа с ними идет в буферизированном режиме. Даже если вы запросите один байт из файла, то считается целый блок (до нескольких килобайт). Затем он переместится в буфер оперативной памяти. Дальше файл читается оттуда, поскольку это быстрее (даже если у вас SSD) и экономит ресурсы чтения/записи внешних носителей. Небольшой файл, к которому часто обращаются, можно (прозрачно для прикладных программ) полностью поместить в оперативную память. На самом жестком диске располагаются буферные зоны с более быстрым доступом — в общем случае мы имеем дело с многоуровневой буферизацией. Поэтому <strong>очень плохо</strong> считывать файл небольшими порциями коротких блоков (до нескольких мегабайт) якобы для уменьшения затрачиваемой памяти.</li>
<li>То, как файлы и каталоги (папки) располагаются на жестком диске, зависит от типа файловой системы. Она может поддерживать сжатие, шифрование, разграничение доступа к данным. Никогда файл, кроме совсем маленьких, не размещается полностью и подряд в определенной области диска. Он разбивается на блоки для рационального расходования места. У блоков есть минимальный размер. Поэтому, даже если вы создадите файл из одного байта, он все равно займет целый блок данных (например, 4 Кб).
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-3-1.png" width="550"/></div>
</li>
<li>Вся работа по буферизации, чтению, записи, открытию, закрытию файла идет через операционную систему. Чаще всего прикладной программист не работает с файловой системой напрямую.</li>
<li>Во многих операционных системах понятие файла как некоторой области данных на носителе, поддерживающих операции чтения/записи, расширено до областей в оперативной памяти, ресурсов сети, оборудования и т. д. Эта концепция называется <strong>«все есть файл»</strong>. Например, в Python есть «файл» sys.stdin, который ассоциирован с клавиатурным вводом и не является классическим файлом.</li>
</ol>
<p>Есть некоторые различия в именовании файлов в unix-подобных ОС и Windows.</p>
<p>Например, в Linux системные файлы, как правило, не имеют расширения. Все устройства и диски добавлены в общее дерево, корень которого обозначается "/".</p>
<p>Для отделения имен папок используется прямой слеш "/", а не обратный, как в Windows.</p>
<p>Приведем примеры специальных «файлов» в ОС Linux:</p>
<ul>
<li>/dev/sd{буква} — жесткий диск (в системах на ядре Linux)</li>
<li>/dev/sd{буква}{номер} — раздел диска (в системах на ядре Linux)</li>
<li>/dev/sr{номер} или /dev/scd{номер} — CD-ROM</li>
<li>/dev/eth{номер} — сетевые интерфейсы Ethernet</li>
<li>/dev/wlan{номер} — сетевые интерфейсы Wireless</li>
<li>/dev/lp{номер} — принтеры</li>
<li>/dev/video{номер} — устройства изображений, камеры, фотоаппараты и т. д.</li>
<li>/dev/bus/usb/000/{номер} — устройство номер на шине USB первого контроллера (000) (в системах на ядре Linux)</li>
<li>/dev/tty{номер} — текстовый терминал</li>
<li>/dev/dsp — звуковой вывод</li>
<li>/dev/random — случайные данные (псевдоустройство)</li>
<li>/dev/null — пусто (псевдоустройство)</li>
<li>/dev/zero — нулевые байты (псевдоустройство)</li>
</ul>
<p><em>{номер} — это порядковый номер устройства</em></p>
</section>
<section class="material__chapter">
<h2 id="2">Перевод строки</h2>
<p>Существует два символа <code>\n</code> и <code>\r</code>, смысл которых взят из эпохи печатных машинок. Посмотрим, какие у них коды:</p>
<pre class="language-python"><code class="language-python"><span class="token comment"># LINE FEED. Перемещает позицию печати на одну строку вниз </span>
<span class="token comment"># (изначально – без возврата каретки машинки).</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># CARRIAGE RETURN. Перемещает позицию печати в крайнее левое положение </span>
<span class="token comment"># (изначально — без перехода на следующую строку).</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>10
13</samp></pre>
<p>В ОС Windows для перевода строки принимается последовательность <code>\r\n</code>, в MacOS (до версии X) — <code>\r</code>, а в Linux — <code>\n</code>.</p>
<p>Сейчас все чаще во всех ОС используется одиночный <code>\n</code>.</p>
<p>Поэтому программисту надо быть внимательным и помнить все варианты перевода строки на той ОС, где будет работать его программа.</p>
</section>
<section class="material__chapter">
<h2 id="3">Файловый путь. Относительные и абсолютные пути</h2>
<p>Путь файла (или путь к файлу) — последовательное указание имен каталогов, через которые надо пройти, чтобы добраться до объекта. Каталоги в записи пути разделяются <strong>слешем</strong>. В зависимости от вида ОС слеши могут быть как прямыми, так и обратными.</p>
<p>На ОС Windows путь выглядит так:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\users\\user\\1.txt'</span><span class="token punctuation">)</span>
</code></pre>
<p>Обратный слеш удваивается как служебный символ. Значит, если он нужен сам по себе, его нужно «экранировать». Вспомните, что в языке Python есть служебные символы (<code>\n</code>, <code>\t</code>).</p>
<p>Для того чтобы сделать работу с файлами универсальнее, в путях файлов в Windows в python-программах рекомендуется ставить прямой слеш. В наших примерах мы так и будем делать.</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:/users/user/1.txt'</span><span class="token punctuation">)</span>
</code></pre>
<p>Если мы укажем относительные пути, например:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"user/1.txt"</span><span class="token punctuation">)</span>
</code></pre>
или
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./user/1.txt"</span><span class="token punctuation">)</span>
</code></pre>
<p>то Python будет искать файл в каталоге, начав отсчет с папки, в которой находится файл с основной python-программой. Это важно помнить в проектах, где много файлов и происходит импорт модулей или функций.</p>
В относительных путях используют обозначения <code class="language-python"><span class="token string">"./"</span></code> для обозначения текущего каталога и <code class="language-python"><span class="token string">"../"</span></code> для обозначения родительского каталога или каталога на один уровень выше по отношению к текущему.
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"../user/1.txt"</span><span class="token punctuation">)</span></code></pre>
<p>Здесь Python будет искать файл в каталоге, начав отсчет с папки, в которой находится файл с основной python-программой, затем поднимется на уровень выше, будет искать там папку <code class="language-python"><span class="token string">"user"</span></code>, а уже в ней файл <code class="language-python"><span class="token string">"1.txt"</span></code></p>
</section>
<section class="material__chapter">
<h2 id="4">Кодировки файлов</h2>
<p>Сейчас принято использовать одну из самых распространенных кодировок — <strong>UTF-8</strong>. Мы поступим так же.</p>
<p>UTF-8 — сложная кодировка, в которой символ кодируется от одного до шестью байтами. Подробнее про эту кодировку можно почитать <a class="material__link" href="https://ru.wikipedia.org/wiki/UTF-8" rel="noopener noreferrer" target="_blank">здесь</a>.</p>
<p>Но помните, что до сих пор существуют и старые однобайтовые кодировки:</p>
<ul>
<li><a class="material__link" href="https://ru.wikipedia.org/wiki/Windows-1251" rel="noopener noreferrer" target="_blank">Windows-1251</a>;</li>
<li><a class="material__link" href="https://ru.wikipedia.org/wiki/CP866" rel="noopener noreferrer" target="_blank">cp-866</a>;</li>
<li><a class="material__link" href="https://ru.wikipedia.org/wiki/КОИ-8" rel="noopener noreferrer" target="_blank">КОИ-8</a>.</li>
</ul>
<p>Они по умолчанию используются в некоторых ОС, например, в Windows.</p>
<p>У пользователей, работающих на компьютерах под управлением ОС Windows, могут возникнуть проблемы с созданием текстовых файлов в кодировке UTF-8. Это происходит из-за того, что ОС Windows до сих по умолчанию использует однобайтовую кодировку Windows-1251. В редакторе Notepad («Блокнот») можно при сохранении указывать ту кодировку, в которой на самом деле хочется сохранить файл, однако все об этом забывают.</p>
<p>Вообще, текстовые файлы стоит открывать в самой IDE PyCharm, что проще всего. При этом нужно помнить, что IDE не добавляет расширение файла автоматически, его нужно указывать явно или выбирать тип из предложенного списка. В этом случае не будет проблем с кодировками. Также можно использовать сторонний текстовый редактор, например, Sublime.</p>
<p>При работе с ОС Linux и MacOS таких проблем не возникает вовсе, поскольку в них кодировка UTF-8 применяется по умолчанию.</p>
<p>Есть еще один вариант, как решить проблему с кодировкой в коде. Надо в первой строке программы написать</p>
<pre class="language-python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
</code></pre>
<p>Это даст интерпретатору указание, что дальнейший код надо воспринимать именно в этой кодировке.</p>
</section>
<section class="material__chapter">
<h2 id="5">Типичные операции с файлами</h2>
<p>Все файлы на диске — последовательность байт. Операционной системе все равно, какой смысл у содержимого файла: это видео, чертеж, картинка, текстовый документ и т. д. Все это остается в компетенции прикладной программы.</p>
<p>Единственное исключение сделано для текстовых файлов, потому что их состав максимально прост (до внедрения Юникода одному символу соответствовал 1 байт). Поэтому если программа знает, что файл текстовый, то сразу читает из файла символы, а не поток байт.</p>
<p>Таким образом, все файлы искусственно разделены на <strong>текстовые</strong> и <strong>бинарные</strong>. Но не забывайте, что любой текстовый файл является бинарным.</p>
<p>Так как общение с файлами идет не напрямую, а через OC, общепринятая последовательность операций с файлом следующая:</p>
<ol>
<li>Попросить ОС открыть файл в различных режимах для чтения или записи, в бинарном или текстовом режиме.</li>
<li>Поработать с информацией из файла, используя в том числе операции чтения/записи.</li>
<li>Закрыть файл.</li>
</ol>
<p>После успешного завершения python-программы все файлы закрываются автоматически. Но важно все равно закрывать файл, как только он перестает быть вам нужным. Это поможет избежать конфликтов совместного доступа или риска получить неконсистентный (испорченный) файл, если программа завершится аварийно.</p>
</section>
<section class="material__chapter">
<h2 id="6">Чтение файла</h2>
<p>Возьмем файл с <a class="material__link" href="https://yastatic.net/s3/lyceum/content/resources/Толстой.txt" rel="noopener noreferrer" target="_blank">первым томом</a> «Войны и мира» Льва Толстого.</p>
<p>Для открытия файлов в Python есть функция <code>open()</code>.</p>
<p>Выполним <code>help(open)</code> для получения справки по этой функции.</p>
<pre class="language-python"><code class="language-python"><span class="token builtin">help</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>Help on built-in function open in module io:
    
open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)
    Open file and return a stream.  Raise IOError upon failure.
        
    file is either a text or byte string giving the name (and the path
    if the file isn't in the current working directory) of the file to
    be opened or an integer file descriptor of the file to be
    wrapped. (If a file descriptor is given, it is closed when the
    returned I/O object is closed, unless closefd is set to False.)
        
...</samp></pre>
<p>Из всех параметров мы используем следующие:</p>
<ul>
<li><var>file</var> — имя открываемого файла. Оно может быть задано с использованием и относительных и абсолютных путей</li>
<li><var>mode</var> — режим открытия. <var>r</var> (или <var>rt</var>) — чтение в текстовом режиме, <var>rb</var> — чтение в бинарном режиме, <var>w</var> — запись, <var>wb</var> — запись в бинарном режиме. По умолчанию файл открывается в режиме <var>r</var></li>
<li><var>encoding</var> — если работа идет в текстовом режиме, Python должен получить имя кодировки, чтобы корректно работать с данными. Независимо от кодировки файла, в результате чтения будет возвращаться стандартная юникод-строка Python</li>
</ul>
<p>Пожалуйста, прочтите полное описание параметров в <a class="material__link" href="https://docs.python.org/3/library/functions.html#open" rel="noopener noreferrer" target="_blank">документации</a> по функции <var>open</var>.</p>
<p>Теперь откроем файл в бинарном режиме и прочитаем первые 20 байт:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"rb"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>b'               -- \xd0\x95'</samp></pre>
<p>Перед строкой стоит модификатор <var>b</var>. Он говорит о том, что перед нами поток байт. Поток байт в языке Python представляется классом <var>bytes</var>. Если вы открываете файл для чтения в бинарном режиме, результат метода <code>read()</code> имеет тип <var>bytes</var>.</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"rb"</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>&lt;class 'bytes'&gt;
149</samp></pre>
<p>Еще раз обратите внимание на то, что в путях до файла используются прямые слеши (/). Можно использовать и обратные, но тогда их придется экранировать либо применять модификатор строки <var>r</var>. Кроме того, в unix-подобных ОС принято использовать именно прямой слеш.</p>
<p>Чтобы понять, что делает модификатор <var>r</var>, рассмотрим пример:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ab\n12"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">r"ab\n12"</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>ab
12
ab\n12</samp></pre>
<p>В первом случае специальный символ <code>\n</code> «отработал» и перевел строку, а во втором — вывелся на экран как есть. Модификатор <var>r</var> отключает спецсимволы, если он указан перед строкой. То есть каждый символ означает сам себя и — ничего более.</p>
<p>Объект, который возвращает нам функция <var>open</var>, ассоциирован (связан) с открытым файлом и содержит следующие поля и методы:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"rb"</span><span class="token punctuation">)</span>
pprint<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>['__class__',
 '__del__',
 '__delattr__',
 '__dict__',
 '__dir__',
 '__doc__',
 '__enter__',
 '__eq__',
 '__exit__',
 '__format__',
 '__ge__',
 '__getattribute__',
 '__getstate__',
 '__gt__',
 '__hash__',
 '__init__',
 '__init_subclass__',
 '__iter__',
 '__le__',
 '__lt__',
 '__ne__',
 '__new__',
 '__next__',
 '__reduce__',
 '__reduce_ex__',
 '__repr__',
 '__setattr__',
 '__sizeof__',
 '__str__',
 '__subclasshook__',
 '_checkClosed',
 '_checkReadable',
 '_checkSeekable',
 '_checkWritable',
 '_dealloc_warn',
 '_finalizing',
 'close',
 'closed',
 'detach',
 'fileno',
 'flush',
 'isatty',
 'mode',
 'name',
 'peek',
 'raw',
 'read',
 'read1',
 'readable',
 'readinto',
 'readinto1',
 'readline',
 'readlines',
 'seek',
 'seekable',
 'tell',
 'truncate',
 'writable',
 'write',
 'writelines']</samp></pre>
<p>Напоминаем, что функция <var>pprint</var> (pretty-print, «изящный вывод») старается сделать печать больших объектов (списков, словарей) более удобной и читаемой для человека.</p>
<p>Назначение почти всех из них легко определяется из названий.</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"rb"</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>readable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>writable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>seekable<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>mode<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>files/Толстой.txt
True
20
False
True
rb</samp></pre>
<p>Теперь откроем файл в текстовом режиме и проверим работу некоторых методов:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">1245</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>               -- Еh bien, mon prince. Gênes et Lucques ne sont plus que des apanages,
            des
103
1245
ла (грипп  был тогда  новое
          слово, употреблявшееся только  редкими).  В записочках, разосл
1416</samp></pre>
<p>Что же произошло:</p>
<ul>
<li>Если мы открываем файл в текстовом режиме, чтение происходит посимвольно (символ может занимать физически 1, 2, 4 и даже 6 байт в некоторых случаях в зависимости от кодировки). За одну операцию можно прочитать различное количество символов</li>
<li>Если мы используем бинарный режим, чтение осуществляется побайтно и за одну операцию можно прочитать сразу несколько байт</li>
<li>Метод <var>tell</var> возвращает позицию в байтах от начала файла, а метод <var>seek</var> изменяет ее (перематывает) на заданную позицию. Использование <var>seek</var> с текстовыми файлами затруднено из-за несоответствия номера байта и номера символа (это видно в предыдущем примере, когда мы считали 100 символов, а <var>tell</var> вернул нам смещение 103)</li>
</ul>
<p>Продолжим экспериментировать:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">1246</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>Traceback (most recent call last):
  File "/home/03.py", line 8, in &lt;module&gt;
    print(f.read(1))
  File "/usr/lib/python3.9/codecs.py", line 322, in decode
    (result, consumed) = self._buffer_decode(data, self.errors, final)
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xbb in position 0: invalid start byte</samp></pre>
<p>Исключение появилось потому, что начиная с 1246-го байта невозможно прочитать символ в кодировке UTF-8.</p>
<p>Из-за буферизации и оптимизации количества операций чтения/записи иногда получается считать вообще весь файл в оперативную память (для этого не надо указывать параметр в методе <var>read</var>). Если его размер до десятков мегабайт, это можно комфортно делать. В результате мы получим одну строку со всем содержимым файла.</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">, length: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>Type: &lt;class 'str'&gt;, length: 887312</samp></pre>
<p>В текстовом режиме можно читать файл построчно с использованием метода <var>readline</var>, при этом маркером конца строки является символ <code>\n</code>:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>   -- Еh bien, mon prince. Gênes et Lucques ne sont plus que des apanages,
des поместья, de la famille Buonaparte.  Non, je  vous préviens, que si vous
ne  me dites pas, que nous avons la guerre, si vous vous permettez encore de
pallier  toutes les infamies, toutes les  atrocités  de cet  Antichrist  (ma
parole, j'y  crois) -- je  ne  vous  connais plus, vous n'êtes plus mon ami,
vous n'êtes  plus  мой  верный  раб,  comme  vous  dites.  [1]  Ну,
здравствуйте, здравствуйте.  Je vois  que  je  vous fais  peur, [2]</samp></pre>
<p>Также можно считать текстовый файл в список строк с помощью метода <var>readlines</var>:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span>
lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Type: %s, length: %d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>lines<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>Type: &lt;class 'list'&gt;, length: 12128
    князя  Василия,  первого  приехавшего  на  её вечер. Анна  Павловна  кашляла</samp></pre>
<p>Файл может быть построчным итератором (выведем только 10 строк):</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/Толстой.txt"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf8"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> number<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token keyword">if</span> number <span class="token operator">&gt;</span> <span class="token number">8</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>    -- Еh bien, mon prince. Gênes et Lucques ne sont plus que des apanages,
 
des поместья, de la famille Buonaparte.  Non, je  vous préviens, que si vous
 
ne  me dites pas, que nous avons la guerre, si vous vous permettez encore de
 
pallier  toutes les infamies, toutes les  atrocités  de cet  Antichrist  (ma
 
parole, j'y  crois) -- je  ne  vous  connais plus, vous n'êtes plus mon ami,
 
vous n'êtes  plus  мой  верный  раб,  comme  vous  dites.  [1]  Ну,
 
здравствуйте, здравствуйте.  Je vois  que  je  vous fais  peur, [2]
 
садитесь и рассказывайте.
 
       Так говорила в июле 1805 года известная Анна Павловна Шерер, фрейлина и
 
приближенная  императрицы  Марии  Феодоровны,  встречая важного и  чиновного</samp></pre>
</section>
<section class="material__chapter">
<h2 id="7">Запись в файл</h2>
<p>Для записи в файл также есть два режима: <var>w</var> (если файл существовал, его содержимое будет потеряно) и <var>a</var> — запись идет в конец файла.</p>
<p>После выбора режима можно также ввести и символ "+". Посмотрите в документации по функции <var>open</var>, что означает такая конструкция.</p>
<p>Один из способов записать информацию в файл — метод <var>write</var>. Если мы хотим сделать запись в середину файла, должны сначала спозиционироваться на место предполагаемой записи (метод <var>seek</var>), а уже потом записывать (метод <var>write</var>). Метод <var>write</var> возвращает количество записанных символов.</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/example.txt"</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'123\n456'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'34352'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/example.txt"</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre><samp>7
3
5
12334352</samp></pre>
<p>Построчно пройдитесь по приведенной программе, чтобы лучше понять, как она работает. Заметьте, что если мы используем <var>seek</var>, то данные при записи все равно будут стерты. Этот процесс похож на рисование фломастером: рисуя поверх, вы закрашиваете старый рисунок.</p>
<p>Второй способ записи в файл — стандартная функция <var>print</var>. Для этого применяется именованный параметр <var>file</var>.</p>
<p>Например:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> sin

f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/example2.txt"</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%0.2f"</span> <span class="token operator">%</span> sin<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>f<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-1.png" width="300"/></div>
<p>Для записи данных в бинарный файл в функцию <code>write()</code> надо передать переменную типа <var>bytes</var>. Например, так:</p>
<pre class="language-python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"files/ex_bin.dt"</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Обратите внимание: в примере мы преобразовываем список в поток байт, чтобы потом записать его в файл.</p>
</section>
<section class="material__chapter">
<h2 id="8">Закрытие файлов</h2>
<p>Операционная система контролирует доступ к файлам. Если какая-то программа открыла файл для записи, все попытки любых других программ изменить содержание файла заблокируются для сохранения целостности.</p>
<p>Поэтому после того как работа с файлом закончена, файл надо <strong>отпустить</strong>, закрыв его методом <var>close</var>, что мы делали практически во всех примерах.</p>
<pre class="language-python"><code class="language-python">f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Повторим, что после завершения программы все файлы, которая она использовала в своей работе, автоматически закроются. Но <strong>хороший стиль программирования</strong> — это как можно раньше закрыть файл.</p>
<section class="material__note">
<p>Поэтому всегда следуйте принципу: «Не нужен файл — отпусти его!»</p>
</section>
<p>И самое последнее: для того чтобы файл закрывался автоматически даже в случае ошибок во время выполнения других операций, в языке Python есть блок <var>with</var>. Его назначение шире, но в нашем случае он дает закрыть файл после выхода из блока.</p>
<p>Его синтаксис такой:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'files/Толстой.txt'</span><span class="token punctuation">,</span> <span class="token string">'rt'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    read_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>read_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>closed<span class="token punctuation">)</span>
</code></pre>
<pre><samp>        -- Еh bien, mon prince. Gênes et Lucques ne sont plus que des apanages,
    des
True</samp></pre>
</section>
<section class="material__chapter">
<h2 id="9">PyQT</h2>
<p>Одним из самых широко используемых виджетов в PyQT для отображения текстовой информации является <strong>QTextBrowser</strong>. Его возможности очень велики. Начнем с того, что создадим интерфейс приложения через QtDesigner и посмотрим на те свойства этого виджета, которые можно ему задать.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-2.png" width="616"/></div>
<p>Кроме стандартных настроек самого виджета (размер виджета, его расположение и т. д.), есть группа настроек, отвечающих за шрифт.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-3-2.png" width="386"/></div>
<p>Интересно, что для того чтобы отображать различный текст, используется язык разметки HTML,с которым вы должны были познакомиться летом. Так что можно вставить свой HTML-код для красивого оформления текста. Для этого в редакторе свойств нужно выбрать поле html, после чего откроется редактор, в котором можно верстать различные тексты. Как в привычном Word-подобном интерфейсе,</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-3.png" width="616"/></div>
<p>так и используя просто HTML.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-4.png" width="616"/></div>
<p>Этот виджет может использоваться не только для отображения информации, но и для ее ввода. Но, поскольку в данном уроке мы будем получать информацию из файлов, мы можем смело настроить режим <strong>readOnly</strong>. Это тоже можно сделать в редакторе свойств QtDesigner.</p>
<p>Теперь реализуем нашу первую программу. Интерфейс можно собрать самостоятельно в дизайнере (или создать в коде), а можно взять вот <a class="material__link" href="https://yastatic.net/s3/lyceum/content/resources/pyqt/TextBrowserSample.ui" rel="noopener noreferrer" target="_blank">тут</a>. Она будет получать какую-то информацию из файла и выводить ее в обратном порядке.</p>
<p>Код вашего класса должен выглядеть примерно вот так:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TextBrowserSample</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TextBrowserSample<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        uic<span class="token punctuation">.</span>loadUi<span class="token punctuation">(</span><span class="token string">'TextBrowserSample.ui'</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>loadButton<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>load_file<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>processButton<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>process_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">load_file</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">process_data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre>
<p>Для начала необходимо загрузить содержимое текста в наш виджет. Напишем для этого простейшую функцию:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">load_file</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span>
                  encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>  
            <span class="token comment"># Если файла нет, то мы получим исключение FileNotFoundError</span>
            self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> FileNotFoundError <span class="token keyword">as</span> ex<span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>statusBar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>showMessage<span class="token punctuation">(</span><span class="token string">'В директории нет файла input.txt'</span><span class="token punctuation">)</span>
</code></pre>
<p>Метод <var>setText</var> позволяет загрузить переданный текст в виджет. Интересно, что, если размер текста превышает размеры виджета по вертикали или горизонтали, автоматически появляется слайдер, позволяющий прокручивать текст.</p>
<p>Дополнительно давайте обработаем случай, когда файла input.txt нет в директории с нашей программой: тогда при попытке получить доступ к файлу будет выброшено исключение FileNotFoundError. При получении такого исключения будем выводить в StatusBar соответствующее сообщение.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-5.png" width="603"/></div>
<p>Теперь мы можем работать с содержимым виджета. Если мы хотим работать с ним как с обычным текстом, игнорируя HTML-теги и форматирование, можно воспользоваться методом <code>toPlainText()</code>.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">process_data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>outputText<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-6.png" width="603"/></div>
<p>Теперь давайте вспомним, что мы можем использовать различное оформление текста. Напишем программу, которая будет окрашивать каждую букву, полученную из файла, в случайный цвет и задавать ей случайный размер. Для этого мы будем использовать HTML-тег <code>&lt;font color="цвет"&gt;...&lt;/font&gt;</code>, а цвет — это случайное шестнадцатиричное число от 0 до 0xFFFFFF.</p>
<p>Напишем другую функцию-слот для обработки нажатия на кнопку «Выполнить»:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">color_text</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> self<span class="token punctuation">.</span>inputText<span class="token punctuation">.</span>toPlainText<span class="token punctuation">(</span><span class="token punctuation">)</span>
    HTML <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#{:06x}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        HTML <span class="token operator">+=</span> <span class="token string">"&lt;font color='{}' size = {} &gt;{}&lt;/font&gt;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            color<span class="token punctuation">,</span> random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>outputText<span class="token punctuation">.</span>setHtml<span class="token punctuation">(</span>HTML<span class="token punctuation">)</span>
</code></pre>
<p>Как он работает? Сначала, как и в первом примере, содержимое текста заносится в переменную. Затем, используя модуль <var>random</var> (не забудьте его импортировать!), мы получаем случайное шестнадцатиричное число — наш цвет, а затем добавляем наш символ в «обрамлении» тега, отвечающего за цвет шрифта и его размер. Подробнее об HTML-тегах можно прочитать в Интернете, например, <a class="material__link" href="http://htmlbook.ru/" rel="noopener noreferrer" target="_blank">здесь</a>.</p>
<p>Ну и для того, чтобы занести форматированный с помощью HTML текст в виджет, понадобится метод <code>setHtml()</code>.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-3/qt-res-3-7.png" width="603"/></div>
<p>В этом уроке мы работали с только с простыми текстовыми файлами, однако форматов гораздо больше. В следующих уроках мы поработаем и с другими популярными форматами.</p>
</section></article></section>