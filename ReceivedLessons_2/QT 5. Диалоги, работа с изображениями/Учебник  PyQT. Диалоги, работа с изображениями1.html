<section class="lesson-material__content"><article class="material"><h1>PyQT. Диалоги, работа с изображениями</h1>
<section class="material__plan"><nav>
<ol>
<li><a class="material__link" href="#1">QPixmap</a></li>
<li><a class="material__link" href="#2">Диалоговые окна для выбора файла</a></li>
<li><a class="material__link" href="#3">Диалоги ввода информации</a></li>
<li><a class="material__link" href="#4">Рисование</a></li>
<li><a class="material__link" href="#5">L-системы</a></li>
</ol>
</nav></section>
<section class="material__annotation">
<h2>Аннотация</h2>
<p>На этом уроке мы рассмотрим возможности PyQT по отображению графических данных, а также изучим возможности рисования непосредственно на виджетах библиотеки.</p>
</section>
<section class="material__chapter">
<h2 id="1">QPixmap</h2>
<p>До сих пор мы работали только с текстовой информацией, однако, как нам подсказывает здравый смысл (и материалы уроков про библиотеки в Python), в файлах может храниться не только текст, но и различные более сложные данные, например: изображения, видео или аудиозаписи. В этом уроке мы познакомимся с возможностями PyQT, позволяющими работать с графикой.</p>
<p>Одним из способов отображения изображения является использование <strong>QPixmap</strong>. Напишем простейшую программу, которая будет демонстрировать заданную картинку.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sys

<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QPixmap
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QApplication<span class="token punctuation">,</span> QLabel<span class="token punctuation">,</span> QMainWindow

SCREEN_SIZE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token operator">*</span>SCREEN_SIZE<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'Отображение картинки'</span><span class="token punctuation">)</span>

        <span class="token comment">## Изображение</span>
        self<span class="token punctuation">.</span>pixmap <span class="token operator">=</span> QPixmap<span class="token punctuation">(</span><span class="token string">'orig.jpg'</span><span class="token punctuation">)</span>
        <span class="token comment"># Если картинки нет, то QPixmap будет пустым, </span>
        <span class="token comment"># а исключения не будет</span>
        self<span class="token punctuation">.</span>image <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>image<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>image<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span>
        <span class="token comment"># Отображаем содержимое QPixmap в объекте QLabel</span>
        self<span class="token punctuation">.</span>image<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pixmap<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> Example<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Хотя раньше мы передавали размеры экрана напрямую в функцию, можно использовать список или какую-то другую структуру для хранения этих данных. Это может пригодиться в том случае, если у вас в программе много окон разного размера, или при повторном открытии окна необходимо восстановить его предыдущий размер.</p>
<p>Обратите ваше внимание на следующий факт: <var>QPixmap</var> не используется для «показывания» изображения. В нем только хранится объект — картинка. Для отображения используется уже знакомый нам <var>QLabel</var>, в который с помощью метода <var>setPixmap</var> загружается наш объект.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-1.png" width="402"/></div>
</section>
<section class="material__chapter">
<h2 id="2">Диалоговые окна для выбора файла</h2>
<p>Но что делать, если мы хотим написать программу, которая позволяет открывать несколько файлов? Менять каждый раз код программы — неоптимально. Использовать <code>input()</code> для ввода имени файла? Но мы же работаем с графическим интерфейсом. Разместить на форме <var>QLineEdit</var>, как мы делали на предыдущих занятиях? Выглядит как выход, но это неудобно по нескольким причинам:</p>
<ul>
<li>Путь к файлу может быть очень длинным и пользователю будет неудобно его вводить. Да и вообще пользователь может с ходу не знать, где находится нужный файл</li>
<li>Пользователь может часто ошибаться при вводе, и нам придется обрабатывать эти ошибки</li>
</ul>
<p>Чтобы повысить удобство для пользователей и минимизировать ошибки ввода, были придуманы так называемые <strong>Диалоговые окна</strong>, которые мы сейчас и попробуем использовать.</p>
<p>Диалоговые окна нужны для того, чтобы получить какую-либо информацию от пользователя. Это может быть текстовая информация, цвет, настройки шрифта и даже файлы. В PyQT уже есть встроенные виджеты, реализующие различные диалоговые окна.</p>
<p>Будем получать путь к файлу с помощью <strong>QFileDialog</strong>. Важно не забыть импортировать этот виджет из <strong>PyQt5.QtWidgets</strong>.</p>
<p>Добавим в функцию загрузки из первой программы следующую строку:</p>
<pre class="language-python"><code class="language-python">fname <span class="token operator">=</span> QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'Выбрать картинку'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre>
<p>И будем передавать в <var>QPixmap</var> не имя файла, а переменную <var>fname</var>. Посмотрим, что будет происходить.</p>
<p>Перед запуском программы открывается окно выбора файла.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-2.png" width="680"/></div>
<p>После выбора файла (после нажатия кнопки «Открыть»), диалог закроется и откроется наша форма с выбранным изображением.</p>
<p>Давайте разберем, какие основные параметры можно передать в метод <var>getOpenFileName</var> диалога работы с файлами, для получения имени файла:</p>
<ol>
<li>Родительский виджет (наш виджет формы)</li>
<li>Заголовок окна. В нашем случае это «Выбрать картинку». Интересный факт: этот заголовок будет отображаться только в Windows и некоторых окружениях рабочего стола в Linux, а в macOS будет игнорироваться</li>
<li>Директория открытия — папка, содержимое которой будет отображаться при открытии диалога. Можно даже дописать имя файла, который будет предлагаться к открытию. Если передать пустые кавычки, поиск начнется в той же папке, где лежит запускаемый нами скрипт</li>
<li>Набор фильтров. Если ничего не передать, будет применен фильтр ’All Files (*)’, который отображает все файлы в директории. Если нужно отобразить только определенные типы файлов, можно это указать строкой вида: ’Картинка (.jpg);;Картинка (.jpg);;Все файлы (*)’. Так мы дадим пользователю выбирать, какие типы файлов он хочет отображать в папке. Разные фильтры отделяются ’;;’.</li>
</ol>
<pre class="language-python"><code class="language-python">fname <span class="token operator">=</span> QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>
    self<span class="token punctuation">,</span> <span class="token string">'Выбрать картинку'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token string">'Картинка (*.jpg);;Картинка (*.jpg);;Все файлы (*)'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-4-filter.png" width="251"/></div>
<p>Остальные параметры метода можно посмотреть в <a class="material__link" href="https://doc.qt.io/qt-5/qfiledialog.html#getOpenFileName" rel="noopener noreferrer" target="_blank">документации</a>.</p>
<p>Обратите внимание: эта функция возвращает кортеж, состоящий из полного пути к файлу, а также выбранный фильтр (по умолчанию — ’All Files (*)’)</p>
</section>
<section class="material__chapter">
<h2 id="3">Диалоги ввода информации</h2>
<p>Кроме диалога, позволяющего выбрать файл, существуют и другие.</p>
<p>Рассмотрим виджет <strong>QInputDialog</strong>. Особенность этого виджета в том, что его можно настроить на получение различных типов данных: строки (одной или нескольких), числа или одного значения из списка, вызывая различные методы.</p>
<p>Напишем программу, которая получает имя пользователя с помощью диалогового окна.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QApplication<span class="token punctuation">,</span> QPushButton
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QInputDialog


<span class="token keyword">class</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'Диалоговые окна'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>button_1 <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"Кнопка"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>run<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name<span class="token punctuation">,</span> ok_pressed <span class="token operator">=</span> QInputDialog<span class="token punctuation">.</span>getText<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"Введите имя"</span><span class="token punctuation">,</span> 
                                                <span class="token string">"Как тебя зовут?"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> ok_pressed<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>name<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> Example<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>В методе, вызываемой нажатием на кнопку, создается диалоговое окно (<var>QInputDialog</var>) и указывается, какой тип оно будет возвращать (<var>getText</var>). В качестве параметров передаются родительское окно (<var>self</var>), заголовок нового окна и сообщение для пользователя. Возвращает эта функция кортеж, где на первом месте записаны введенные пользователем данные (или пустая строка, если нажата кнопка «Отмена»), а на втором — состояние кнопки «Ok».</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-3.png" width="199"/></div>
<p>В случае если мы хотим получить целое число, лучше воспользоваться методом <code>getInt()</code>, в котором мы можем указать значение по умолчанию, минимальное значение, максимальное значение и шаг.</p>
<pre class="language-python"><code class="language-python">age<span class="token punctuation">,</span> ok_pressed <span class="token operator">=</span> QInputDialog<span class="token punctuation">.</span>getInt<span class="token punctuation">(</span>
    self<span class="token punctuation">,</span> <span class="token string">"Введите возраст"</span><span class="token punctuation">,</span> <span class="token string">"Сколько тебе лет?"</span><span class="token punctuation">,</span>
    <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<p>В этом примере значение по умолчанию — 20, минимальное значение — 18, максимальное — 27, а шаг — 1.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-4.png" width="199"/></div>
<p>Иногда нам нужно, чтобы пользователь выбрал какое-то значение из предоставленных. Для этого есть метод <var>getItem</var>.</p>
<pre class="language-python"><code class="language-python">country<span class="token punctuation">,</span> ok_pressed <span class="token operator">=</span> QInputDialog<span class="token punctuation">.</span>getItem<span class="token punctuation">(</span>
    self<span class="token punctuation">,</span> <span class="token string">"Выберите вашу страну"</span><span class="token punctuation">,</span> <span class="token string">"Откуда ты?"</span><span class="token punctuation">,</span> 
    <span class="token punctuation">(</span><span class="token string">"Россия"</span><span class="token punctuation">,</span> <span class="token string">"Германия"</span><span class="token punctuation">,</span> <span class="token string">"США"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
<p>В качестве параметров необходимо указать: родителя, заголовок окна, вопрос, итерируемый объект с вариантами ответа и индекс значения по умолчанию. А чтобы пользователь не смог что-то самостоятельно ввести, укажем следующим параметром False.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-5.png" width="199"/></div>
<p>Для выбора цвета существует другой виджет — <strong>QColorDialog</strong>. Вот пример программы с его использованием:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QApplication<span class="token punctuation">,</span> QPushButton
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QColorDialog


<span class="token keyword">class</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'Диалоговые окна'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>button_1 <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"Кнопка"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>run<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> QColorDialog<span class="token punctuation">.</span>getColor<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> color<span class="token punctuation">.</span>isValid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>button_1<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span>
                <span class="token string">"background-color: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>color<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> Example<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Если цвет валиден, фон кнопки окрасится в него. Функция <code>.name()</code> возвращает цвет в шестнадцатитиричном формате. Управлять стилями элементов достаточно просто, синтаксис похож на CSS, с которым вы должны были познакомиться во время изучения HTML.</p>
<p>Примеры можно посмотреть в <a class="material__link" href="https://doc.qt.io/qtforpython/overviews/stylesheet-examples.html" rel="noopener noreferrer" target="_blank">документации</a>.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-6.png" width="522"/></div>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-7.png" width="152"/></div>
</section>
<section class="material__chapter">
<h2 id="4">Рисование</h2>
<p>До этого момента, чтобы создать и вывести какое-либо изображение, надо было создавать картинку с помощью PIL, а затем выводить ее, используя виджет <var>QPixmap</var>. Но в PyQT есть модули, которые позволяют рисовать прямо на самих виджетах. Посмотрим, как с ними работать.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sys

<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QPainter<span class="token punctuation">,</span> QColor
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QApplication


<span class="token keyword">class</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'Рисование'</span><span class="token punctuation">)</span>

    <span class="token comment"># Метод срабатывает, когда виджету надо </span>
    <span class="token comment"># перерисовать свое содержимое, </span>
    <span class="token comment"># например, при создании формы</span>
    <span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Создаем объект QPainter для рисования</span>
        qp <span class="token operator">=</span> QPainter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># Начинаем процесс рисования</span>
        qp<span class="token punctuation">.</span>begin<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>draw_flag<span class="token punctuation">(</span>qp<span class="token punctuation">)</span>
        <span class="token comment"># Завершаем рисование</span>
        qp<span class="token punctuation">.</span>end<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_flag</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> qp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Задаем кисть</span>
        qp<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>QColor<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># Рисуем прямоугольник заданной кистью</span>
        qp<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>QColor<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>QColor<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> Example<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-8.png" width="242"/></div>
<p>Заметьте: все работает, несмотря на то, что мы явно нигде не вызываем метод <code>paintEvent()</code>. Этот метод вызывается автоматически в те моменты, когда виджет понимает, что ему надо обновить свой внешний вид, например, при создании формы. Кроме того, в качестве параметра присутствует некий <var>event</var> — событие. Это событие, на которое подвешивается обработчик, например: движение, нажатие или отпускание кнопки мыши, нажатие или отпускание клавиши клавиатуры и многое другое.</p>
<p>В методе <var>paintEvent()</var> происходит инициализация экземпляра класса <var>QPainter</var>, который отвечает за рисование на виджетах. Рисовать нужно между вызовами методов <var>begin</var> и <var>end</var>.</p>
<p>В методе <var>drawFlag()</var> происходит непосредственно рисование. С помощью метода <var>setBrush</var> мы задаем цвет кисти в формате RGB. Этот метод принимает на вход не кортеж цветовых компонент, а экземпляр класса <var>QColor</var>. А он уже, в свою очередь, при создании может принимать цветовые компоненты RGB. Подробнее про возможности <var>QColor</var> можно посмотреть в <a class="material__link" href="https://doc.qt.io/qt-5/qcolor.html" rel="noopener noreferrer" target="_blank">документации</a>.</p>
<p>Кроме метода <code>setBrush()</code>, у <var>QPainter</var> есть еще метод <code>setPen()</code>, который также принимает в качестве параметра объект <var>QColor</var>. Разница в том, что кисть задает цвет заливки, а ручка — цвет обводки.</p>
<p>Сам процесс рисования очень похож на тот, с каким мы сталкивались при изучении библиотеки Pillow. Например, чтобы нарисовать прямоугольник, применяем метод <code>drawRect()</code>. В качестве параметров ему передаются координаты левого верхнего угла, длина и высота. Как и в Pillow, существуют различные методы для рисования разных графических объектов, например:</p>
<ul>
<li><code>drawArc()</code> — для рисования дуги</li>
<li><code>drawEllipse()</code> — для эллипсов</li>
<li><code>drawLine()</code> — для линий</li>
<li><code>drawPolygon()</code> — для многоугольников</li>
<li><code>drawText()</code> — для текста</li>
</ul>
<p>Подробнее про эти и другие методы <var>QPainter</var> можно почитать в <a class="material__link" href="https://doc.qt.io/qt-5/qpainter.html" rel="noopener noreferrer" target="_blank">документации</a>.</p>
<p><strong>Важное замечание:</strong> библиотека PyQT устроена таким образом, что рисовать можно <strong>только</strong> внутри <code>paintEvent()</code>, а сам <code>paintEvent()</code> вызывается не по всем событиям, например, нажатие кнопки само по себе не приводит с появлению сигнала на перерисовку. Но есть и хорошие новости: никто не запрещает вам рисовать в другом месте, например, на <var>QPixmap</var>, а потом отображать результат, как мы рассматривали в первом примере этого урока. Кроме того, вы в любой момент можете принудительно заставить форму перерисоваться, для этого надо вызвать у нее метод <code>update()</code> или <code>repaint()</code>.</p>
<p>Давайте немного изменим предыдущий пример, чтобы рисование происходило только после нажатия на кнопку:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sys

<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QPainter<span class="token punctuation">,</span> QColor
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QApplication<span class="token punctuation">,</span> QPushButton


<span class="token keyword">class</span> <span class="token class-name">Example</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'Рисование'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">'Рисовать'</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>do_paint <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>btn<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>paint<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>do_paint<span class="token punctuation">:</span>
            qp <span class="token operator">=</span> QPainter<span class="token punctuation">(</span><span class="token punctuation">)</span>
            qp<span class="token punctuation">.</span>begin<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>draw_flag<span class="token punctuation">(</span>qp<span class="token punctuation">)</span>
            qp<span class="token punctuation">.</span>end<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">paint</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>do_paint <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>repaint<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_flag</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> qp<span class="token punctuation">)</span><span class="token punctuation">:</span>
        qp<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>QColor<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>QColor<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>QColor<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> Example<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/paintbutton1.gif" width="205"/></div>
<p>Рассмотрим еще один пример: напишем программу, которая будет рисовать пятиконечную звездочку. Для этого необходимо рассчитать точки. Пятиконечная звезда получается из правильного пятиугольника, если соединять точки через одну. Так что сначала нарисуем пятиугольник, а затем — звезду. Важно помнить, что наши координаты, в которых мы привыкли работать, могут не совпадать с экранными.</p>
<p>Для начала напишем функции, которые будут пересчитывать координаты в экранные.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">xs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> SCREEN_SIZE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> <span class="token number">2</span>


<span class="token keyword">def</span> <span class="token function">ys</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> SCREEN_SIZE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> <span class="token number">2</span> <span class="token operator">-</span> y
</code></pre>
<p>А теперь вместо метода <var>draw_flag()</var> напишем метод <var>draw_star()</var>. Для его работы, кроме тех модулей, про которые мы говорили выше, нам понадобятся объекты следующих модулей: <var>Qt</var>, <var>QPen</var>, <var>math</var>. Так что важно не забыть импортировать их.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">from</span> math <span class="token keyword">import</span> cos<span class="token punctuation">,</span> pi<span class="token punctuation">,</span> sin

<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> Qt
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QPainter<span class="token punctuation">,</span> QPen
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QWidget<span class="token punctuation">,</span> QApplication

SCREEN_SIZE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">]</span>
<span class="token comment"># Задаём длину стороны и количество углов</span>
SIDE_LENGTH <span class="token operator">=</span> <span class="token number">200</span>
SIDES_COUNT <span class="token operator">=</span> <span class="token number">5</span>


<span class="token keyword">class</span> <span class="token class-name">DrawStar</span><span class="token punctuation">(</span>QWidget<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token operator">*</span>SCREEN_SIZE<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'Рисуем звезду'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        qp <span class="token operator">=</span> QPainter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>begin<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>draw_star<span class="token punctuation">(</span>qp<span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>end<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">xs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x <span class="token operator">+</span> SCREEN_SIZE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">//</span> <span class="token number">2</span>

    <span class="token keyword">def</span> <span class="token function">ys</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> SCREEN_SIZE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> <span class="token number">2</span> <span class="token operator">-</span> y

    <span class="token keyword">def</span> <span class="token function">draw_star</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> qp<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token comment"># Считаем координаты и переводим их в экранные</span>
        nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>SIDE_LENGTH <span class="token operator">*</span> cos<span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> pi <span class="token operator">/</span> SIDES_COUNT<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  SIDE_LENGTH <span class="token operator">*</span> sin<span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> pi <span class="token operator">/</span> SIDES_COUNT<span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>SIDES_COUNT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        nodes2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>xs<span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ys<span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes<span class="token punctuation">]</span>

        <span class="token comment"># Рисуем пятиугольник</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nodes2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            qp<span class="token punctuation">.</span>drawLine<span class="token punctuation">(</span><span class="token operator">*</span>nodes2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>nodes2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># Изменяем цвет линии</span>
        pen <span class="token operator">=</span> QPen<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>red<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        qp<span class="token punctuation">.</span>setPen<span class="token punctuation">(</span>pen<span class="token punctuation">)</span>

        <span class="token comment"># Рисуем звезду</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nodes2<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            qp<span class="token punctuation">.</span>drawLine<span class="token punctuation">(</span><span class="token operator">*</span>nodes2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>nodes2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> DrawStar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Сначала мы высчитываем координаты и переводим их в экранные. Затем мы используем метод <var>drawLine</var> объекта класса <var>QPainter</var>, в него поступают координаты двух точек, между которыми строится линия. Пройдясь по всем точкам, мы получим пятиугольник. По умолчанию рисование происходит с помощью «кисти» черного цвета и с толщиной, равной единице. Создадим новую кисть <code>pen = QPen(Qt.red, 2)</code> и применим ее. А затем, пробегаясь по тем же точкам, но через одну, получим изображение звезды.</p>
<div class="material__content-positioner"><img class="material__illustration material__screenshot" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-res-4-9.png" width="402"/></div>
</section>
<section class="material__chapter">
<h2 id="5">L-системы</h2>
<p>В 1968 г. венгерский биолог и ботаник <a class="material__link" href="https://ru.wikipedia.org/wiki/Линденмайер,_Аристид" rel="noopener noreferrer" target="_blank">Аристид Линденмайер</a> (Aristid Lindenmayer) предложил математическую модель для изучения развития простых многоклеточных организмов, которая позже была расширена и используется для моделирования сложных ветвящихся структур — разнообразных деревьев и цветов.</p>
<p>Эта модель получила название Lindenmayer System, или просто L-System. Свои идеи Линденмайер изложил в книге «Алгоритмическая красота растений» (The Algorithmic Beauty of Plants).</p>
<p>Идею можно объяснить так: сложный объект получается из простого с помощью перезаписи частей этого простого объекта по определенным ранее правилам. L-система является частным случаем фракталов.</p>
<p>Представьте, что вы — художник. Но у вас есть только карандаш, поле для творчества — лист бумаги, и вы умеете выполнять только определенный набор команд (например, «поставить карандаш на бумагу», «поднять карандаш в воздух», «нарисовать линию», «повернуться на угол» и т.д.) Для того чтобы нарисовать на листе бумаги картину, вы получаете задание — строку символов, которую вам готовит L-автомат. Назовем эту строку <strong>L-строкой</strong>.</p>
<p>Итак, первый этап решения задачи — формирование L-строки, второй — построение по этой строке рисунка.</p>
<p>L-автомат не может сформировать L-строку «из неоткуда». Поэтому, у него есть <strong>аксиома</strong> — строка, которая определяет начало эволюции. Для дальнейшего развития L-автомат использует <strong>теоремы</strong> — правила, по которым и будет происходить преобразование L-строки.</p>
<p>Чтобы построить L-систему мы определим символы, которыми кодируется L-строка и опишем действия, которые производит художник, обрабатывая любой из символов.</p>
<div class="material__content-positioner">
<table border="1" cellpadding="5px" style="border-collapse: collapse;">
<tbody>
<tr>
<th>Символ</th>
<th>Действие</th>
</tr>
<tr>
<td>F</td>
<td>Начертить отрезок из точки, в которой находится карандаш под текущим углом, и остаться в новой точке.</td>
</tr>
<tr>
<td>f</td>
<td>Перенести карандаш из точки под текущим углом и остаться в новой точке, но не чертить отрезок.</td>
</tr>
<tr>
<td>+</td>
<td>Повернуться на заданный угол по часовой стрелке.</td>
</tr>
<tr>
<td>-</td>
<td>Повернуться на заданный угол против часовой стрелки.</td>
</tr>
<tr>
<td>[</td>
<td>Сохранить текущее состояние карандаша.</td>
</tr>
<tr>
<td>]</td>
<td>Вернуться в предыдущее сохраненное состояние карандаша.</td>
</tr>
<tr>
<td>|</td>
<td>Повернуться на 180 градусов.</td>
</tr>
</tbody>
</table>
</div>
<p>Необходимо пояснить некоторые моменты. Что такое <strong>текущий угол</strong> и <strong>состояние карандаша</strong>? Дело в том, что перед построением рисунка мы должны определиться со значением угла, на который мы будем поворачиваться в процессе работы, а под состоянием карандаша мы будем понимать набор из координат карандаша на листе и значения угла. Договоримся, что изначально угол равен нулю, а карандаш расположен в начале координат. Кроме того, надо знать длину шага для рисования.</p>
<p>Мы уже упомянули, что каждая фигура определяется своей аксиомой и набором теорем.</p>
<p>Например, аксиома может быть задана так:</p>
<pre><code>F
</code></pre>
<p>Это означает, что наша система изначально представлена L-строкой F. То есть для того чтобы ее построить, мы возьмем из списка правил действие для строки F и выполним его, то есть построим линию.</p>
<p>Допустим, у нас есть только одна теорема и она выглядит так:</p>
<pre><code>F -&gt; F-F++F-F
</code></pre>
<p>Это означает, что на каждом шаге для получения новой эволюции L-строки мы должны каждый символ F заменить на последовательность: F-F++F-F.</p>
<p>Посмотрите на то, что будет представлять L-строка на первых 3-х шагах алгоритма.</p>
<div class="material__content-positioner">
<table border="1" cellpadding="5px" style="border-collapse: collapse;">
<tbody>
<tr>
<th>Этап</th>
<th>L-строка</th>
</tr>
<tr>
<td>0</td>
<td>F</td>
</tr>
<tr>
<td>1</td>
<td>F-F++F-F</td>
</tr>
<tr>
<td>2</td>
<td>F-F++F-F-F-F++F-F++F-F++F-F-F-F++F-F</td>
</tr>
<tr>
<td>3</td>
<td>F-F++F-F-F-F++F-F++F-F++F-F-F-F++F-F-F-F++F-F-F-F++F-F++F-F++F-F-F-F++F-F++F-F++F-F-F-F++F-F++F-F++F-F-F-F++F-F-F-F++F-F-F-F++F-F++F-F++F-F-F- F++F-F</td>
</tr>
</tbody>
</table>
</div>
<p>В результате L-автомат будет содержать L-строку, которая описывает заданный фрактал — кривую Коха.</p>
<p>Вспомним про начальные условия и зададим угол поворота в 60 градусов.</p>
<p>Нулевой шаг алгоритма, L=F — рисуем отрезок.</p>
<p>Первый шаг алгоритма, L=F-F++F-F — рисуем отрезок, затем поворачиваемся против часовой стрелки на 60 градусов, затем опять рисуем отрезок, затем следует поворот на 120 градусов по часовой стрелке, рисование отрезка, поворот на 60 градусов против часовой стрелки и — ура — последний отрезок.</p>
<div class="material__content-positioner"><img class="material__illustration" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-4-1.png" width="500"/></div>
<p>Рассмотрим более сложную L-систему:</p>
<p>Угол: 90 градусов</p>
<p>Аксиома: X</p>
<p>Теоремы:</p>
<p>X =&gt; -YF+XFX+FY-</p>
<p>Y =&gt; +XF-YFY-FX+</p>
<p>В этой L-системе присутствуют символы, которые не входят в перечень действий карандаша. В этом нет ничего страшного. При создании L-строки такие символы будут использованы, а при построении фрактала — нет, они будут просто проигнорированы.</p>
<div class="material__content-positioner">
<table border="1" cellpadding="5px" style="border-collapse: collapse;">
<tbody>
<tr>
<th>Этап</th>
<th>L-строка</th>
</tr>
<tr>
<td>0</td>
<td>X</td>
</tr>
<tr>
<td>1</td>
<td>-YF+XFX+FY-</td>
</tr>
<tr>
<td>2</td>
<td>-+XF-YFY-FX+F+-YF+XFX+FY-F-YF+XFX+FY-+F+XF-YFY-FX+-</td>
</tr>
</tbody>
</table>
</div>
<p>При построении первого шага мы:</p>
<ol>
<li>Повернемся на 90 градусов против часовой стрелки</li>
<li>Y – проигнорируем</li>
<li>Нарисуем отрезок</li>
<li>Повернемся на 90 градусов по часовой стрелке</li>
<li>Х – проигнорируем</li>
<li>Нарисуем отрезок</li>
<li>Опять проигнорируем Х</li>
<li>Повернемся на 90 градусов по часовой стрелке</li>
<li>Нарисуем отрезок</li>
<li>Y – проигнорируем</li>
<li>Повернемся на 90 градусов против часовой стрелки</li>
</ol>
<p>И в результате получим ... кривую Гильберта. Нужно отметить, что фрактал нулевой глубины в данном случае не имеет картинки, поскольку L-строка содержит символ «X», который никак не отображается. А вот для фрактала пятой глубины получим:</p>
<div class="material__content-positioner"><img class="material__illustration" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-4-2.gif" width="223"/></div>
<p>Остановимся немного на поворотах. Допустим ваш карандаш находится в точке с координатами (x<sub>0</sub>, y<sub>0</sub>), а текущий угол — α. Пусть длина шага равна — l. Тогда координаты карандаша после окончания рисования можно вычислить по следующим формулам:</p>
<div class="material__content-positioner"><img class="material__illustration" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-4-3.png" width="177"/></div>
<p>При этом углы должны быть указаны в <strong>радианах</strong>. Если же мы указываем углы в градусах, то формулы приобретают следующий вид:</p>
<div class="material__content-positioner"><img class="material__illustration" height="auto" src="https://yastatic.net/s3/lyceum/content/images/second-year/pyqt-4/qt-4-4.png" width="195"/></div>
<p>Поворот на определенный угол сводится к следующему:</p>
<pre class="language-python"><code class="language-python">alpha <span class="token operator">=</span> <span class="token punctuation">(</span>alpha <span class="token operator">+</span> phi<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">360</span>
</code></pre>
<p>Все необходимые функции: синус, косинус, перевод градусов в радианы и обратно — можно найти в модуле math, который входит в стандартную библиотеку.</p>
</section></article></section>